# Safety Rules — Защита данных

## КРИТИЧЕСКИ ВАЖНО

Все деструктивные и потенциально деструктивные действия требуют **явного подтверждения пользователя** перед выполнением.

## Запрещённые действия без явного разрешения

### База данных
- `DELETE FROM` — удаление записей
- `DROP TABLE` / `DROP DATABASE` — удаление таблиц/БД
- `TRUNCATE TABLE` — очистка таблиц
- `UPDATE` с `WHERE` на большое количество записей
- `alembic downgrade` — откат миграций
- Любые изменения схемы БД в production

### Git
- `git reset --hard` — потеря изменений
- `git push --force` — перезапись истории
- `git branch -D` — удаление веток
- `git clean -f` — удаление untracked файлов
- `git checkout .` / `git restore .` — отмена всех изменений

### Docker
- `docker-compose down -v` — удаление volumes с данными
- `docker volume rm` — удаление volumes
- `docker system prune` — очистка системы
- Удаление контейнеров с persistent data

### Файловая система
- `rm -rf` на директории с данными
- Удаление `.env`, конфигов, миграций
- Перезапись файлов с данными пользователей

### Redis
- `FLUSHDB` / `FLUSHALL` — очистка кэша
- `DEL` на критичные ключи

## Протокол безопасности

### Перед деструктивным действием:

1. **Остановись** — не выполняй команду
2. **Опиши** — что именно будет удалено/изменено
3. **Спроси** — запроси явное подтверждение через AskUserQuestion
4. **Дождись** — выполняй только после "да" / "подтверждаю"

### Пример диалога:

```
Claude: Для выполнения этой задачи нужно удалить все записи
        из таблицы food_log_entry за 2023 год (примерно 1500 записей).

        Подтверждаете удаление?

User: Да, удаляй

Claude: [выполняет DELETE]
```

## Безопасные альтернативы

| Вместо | Используй |
|--------|-----------|
| `DELETE FROM table` | `UPDATE table SET is_deleted = true` (soft delete) |
| `DROP TABLE` | Создай backup перед удалением |
| `git reset --hard` | `git stash` для сохранения изменений |
| `docker-compose down -v` | `docker-compose down` (без -v) |

## Исключения

Разрешено без подтверждения:
- Удаление тестовых данных в test environment
- `git add`, `git commit` (не деструктивные)
- Перезапуск контейнеров без потери данных
- Удаление временных файлов (`*.pyc`, `__pycache__`, `.pytest_cache`)
